<!-- Toast feed back user about changes in back end -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="userFeedBack" class="toast align-items-center text-white border-0" [ngClass]="userFeedBackStyle" role="alert"
        aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                {{userFeedBackMessage}}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                aria-label="Close"></button>
        </div>
    </div>
</div>
<!--End of Modal feed back user about changes in back end -->

<main id="main">
    
    <nav *ngIf="totalPages>0">
        <span>Pages ({{currentPage+1}} of {{totalPages}}) => rules number {{totalResults}}</span>
        <ul class="pager" style="display: flex; justify-content: center;">
            <li><a *ngIf="currentPage!=0" (click)="onFilterChange(currentPage-1)" title="Previous page">«</a></li>
            <li *ngFor="let item of [].constructor(this.totalPages); let i=index"
                [ngClass]="i==currentPage?'active':''">
                <a (click)="onFilterChange(i)">{{i+1}}</a>
            </li>
            <li><a *ngIf="currentPage!=totalPages-1" (click)="onFilterChange(currentPage+1)" title="Next page">»</a>
            </li>
        </ul>
    </nav>
    <br>
    <ng-container *ngIf="(rulesDataState$ | async) as result" [ngSwitch]="result.dataState">
        
        <ng-container *ngSwitchCase="RuleStateEnum.LOADING">
            Loading .....
        </ng-container>
        
        <ng-container *ngSwitchCase="RuleStateEnum.ERROR">
            <div class="alert-danger">
                {{result.errorMessage}}
            </div>
        </ng-container>
        
        <ng-container *ngSwitchCase="RuleStateEnum.LOADED">
            <table class="table table-striped table-administration">
                <tbody>
                    <tr>
                        <th>Id</th>
                        <th>Order</th>
                        <th>Part</th>
                        <th>Label</th>
                        <th>Condition</th>
                        <th>Command (EN)</th>
                        <th>Style</th>
                        <th style="width: 150px;">
                            <ng-template #Reset>
                                <span style="white-space: normal; max-width:200px;  word-wrap:break-word;">
                                    Reset All Filters
                                </span>
                            </ng-template>
                            <i [ngClass]="filterActive? 'bi-funnel-fill': 'bi-funnel'"
                                style="cursor:pointer; font-size: 1.5em"  [ngbTooltip]='Reset'
                                class="bi me-3"></i>
                            <ng-template #NewRule>
                                <span style="white-space: normal; max-width:200px;  word-wrap:break-word;">
                                    Add a New Rule
                                </span>
                            </ng-template>
                            <i style="cursor:pointer; font-size: 1.5em"  [ngbTooltip]='NewRule'
                                class="bi bi-plus-circle me-2"></i>
                            
                        </th>
                        
                    </tr>
                    <tr *ngFor="let r of rules">
                        <td>{{r.id}}</td>
                        <td>{{r.order}}</td>
                        <td>{{r.part}}</td>
                        <td>{{r.label}}</td>
                        <td>{{r.ruleCondition.textCondition}}</td>
                        <td>{{r.ruleCondition.ruleCommand[0].command}}</td>
                        <!--<td #position contentEditable (blur)="editRuleOnline(r, position.innerText, 'position')">
                            {{r.position}}</td>-->
                        <!--<td #format contentEditable (blur)="editRuleOnline(r, format.innerText, 'format')">{{r.format}}
                        </td>-->
                        <td>{{r.style?.name}}</td>
                        <td>
                            <ng-template #htmlContent>
                                <span style="white-space: normal; max-width:200px;  word-wrap:break-word;">
                                    {{r.comment}}
                                </span>
                            </ng-template>
                            <i class="bi bi-trash p-2" style="cursor:pointer"  (click)="deleteRule(r)" ngbTooltip="Delete this Rule" placement="right"></i>
                            <i class="bi bi-pencil p-2" style="cursor:pointer" (click)="editRule(r)" ngbTooltip="Edit this Rule" placement="right"></i>
                            <i class="bi bi-files p-2" style="cursor:pointer"  (click)="duplicateRule(r)" ngbTooltip="Duplicate this Rule" placement="right"></i>
                            <i *ngIf="r.comment!=''" [ngbTooltip]="htmlContent" class="bi bi-info-circle p-2"></i>
                        </td>
                    </tr>
                </tbody>
            </table>
        </ng-container>
    </ng-container>
    <!-- End-Table-Responsive -->

</main>
